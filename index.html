<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>F-Four Bakery</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body style="font-family:Arial;padding:15px">

<h2>F-Four Bakery</h2>

<!-- Branch -->
<p><b>Branch</b></p>
<select id="branch" style="width:100%;padding:10px">
  <option value="">-- Select Branch --</option>
  <option>Sonthormuk</option>
  <option>Camco</option>
  <option>Olympic</option>
  <option>Setec</option>
</select>

<hr>

<!-- Menu -->
<h3>ğŸ Menu</h3>

<div>
  Butter Bread - $1
  <button onclick="add('Butter Bread',1)">Add</button>
</div>

<div>
  Chocolate Cake - $12
  <button onclick="add('Chocolate Cake',12)">Add</button>
</div>

<div>
  Croissant - $1.5
  <button onclick="add('Croissant',1.5)">Add</button>
</div>

<hr>

<!-- Cart -->
<h3>ğŸ›’ Cart</h3>
<div id="cart"></div>
<p><b>Total: $<span id="total">0</span></b></p>

<hr>

<!-- Order Type -->
<h3>ğŸšš Order Type</h3>
<select id="orderType" style="width:100%;padding:10px">
  <option value="">-- Delivery or Pickup --</option>
  <option value="Delivery">Delivery</option>
  <option value="Pickup">Pickup</option>
</select>

<input id="phone" placeholder="Phone Number" style="width:100%;padding:10px;margin-top:8px">
<input id="address" placeholder="Address (Delivery only)" style="width:100%;padding:10px;margin-top:8px">

<hr>

<!-- Payment -->
<h3>ğŸ’° Payment</h3>
<select id="payment" style="width:100%;padding:10px">
  <option value="">-- Payment Method --</option>
  <option value="COD">Cash on Delivery</option>
  <option value="ABA">ABA QR</option>
</select>

<hr>

<button onclick="checkout()" style="padding:12px;width:100%;background:#c49b63;color:white;border:none">
  Confirm Order
</button>

<script>
Telegram.WebApp.expand();

let cart = [];
let total = 0;

function add(name, price){
  cart.push({name, price});
  total += price;
  render();
}

function render(){
  let html = "";
  cart.forEach((i,idx)=>{
    html += (idx+1)+". "+i.name+" - $"+i.price+"<br>";
  });
  document.getElementById("cart").innerHTML = html;
  document.getElementById("total").innerText = total.toFixed(2);
}

function checkout(){
  if(cart.length==0){ alert("Cart empty"); return; }
  if(!branch.value || !orderType.value || !payment.value || !phone.value){
    alert("Please fill all required fields");
    return;
  }

  let order = {
    branch: branch.value,
    items: cart,
    total: total,
    orderType: orderType.value,
    payment: payment.value,
    phone: phone.value,
    address: address.value,
    status: "PENDING",
    created_at: new Date()
  };

  alert("Order Created!\nTotal: $" + total);
  console.log(order);

  // Send Telegram Notification
  sendTelegramNotification(order, "AUTO_ORDER_ID_001");

  // Reset Cart
  cart = []; total = 0; render();
}

// ----------------------
// Telegram Notification
// ----------------------
function sendTelegramNotification(order, orderId){
  const chatId = "-5267472097"; // Your Chat ID
  const botToken = "8259747744:AAFAbj-LCJyLvF8mbP8CG4y5C-30VbqWQFQF"; // Your Bot Token

  const text = `ğŸ§¾ New Order #${orderId}\n` +
               `ğŸª Branch: ${order.branch}\n` +
               `ğŸ›’ Items: ${order.items.map(i=>i.name).join(", ")}\n` +
               `ğŸ’° Total: $${order.total}\n` +
               `ğŸ’³ Payment: ${order.payment}\n` +
               `ğŸšš Type: ${order.orderType}\n` +
               `ğŸ“ Phone: ${order.phone}\n` +
               `ğŸ  Address: ${order.address}`;

  // Browser Fetch (may fail due to CORS)
  fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ chat_id: chatId, text: text })
  })
  .then(res => res.json())
  .then(data => console.log("Telegram Notification sent:", data))
  .catch(err => console.error("Telegram Notification error:", err));
}
</script>


<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>

  </body>
</html>
